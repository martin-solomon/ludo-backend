name: Upload complete repo to SFTP

on: [push]

jobs:
  Upload-Files:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v3

      - name: ðŸ“‚ SFTP uploader
        uses: wangyucode/sftp-upload-action@v2.0.4
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }} # Use private key for security
          remoteDir: "/home/ec2-user/newcol/modules"
          localDir: "./Backend/modules"
      - name: Run remote command via SSH
        uses: appleboy/ssh-action@v1.0.3 # Or another SSH command runner action
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          key: ${{ secrets.SERVER_SSH_PRIVATE_KEY }}
          script: |
            cd /home/ec2-user/newcol
            docker-compose restart
